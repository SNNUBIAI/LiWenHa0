# 脑科学磁共振成像（MRI)

## 功能脑网络

-首先获取了每个脑区的信号序列。其次，计算任意两个信号序列间的相关（**皮尔逊相关**）。这样，把脑区视为节点，相关值视为边，功能网络就构建好啦！

![图片](https://ask.qcloudimg.com/http-save/yehe-8223537/e038ba753c8ef7bc3a3cec766932b392.png)

-红色脑区的信号序列（均值）和蓝色脑区的信号序列（均值）做一下**相关**，**就是红区和蓝区间的FC值**（[在神经科学中，功能连接（Functional Connectivity，简称FC）是一个非常重要的概念。它表示从空间不同区域记录的活动的时间相关性，通常被解释为区域间通信的度量](https://bing.com/search?q=FC值在功能脑网络中的作用)[1](https://bing.com/search?q=FC值在功能脑网络中的作用)[。也就是说，更强的功能连接被认为反映了大脑区域之间“交流”的时间平均强度](https://bing.com/search?q=FC值在功能脑网络中的作用)[1](https://bing.com/search?q=FC值在功能脑网络中的作用)），也就是红蓝脑区间的连边值。

![图片](https://ask.qcloudimg.com/http-save/yehe-8223537/7cf5815761089fc2303338a1e3d7bee9.png)

-**两个节点（红色脑区和蓝色脑区）和一个连边的最小“脑网络”已经构建好了**。当我们把任意**两个脑区信号序列的相关计算出来后**，一个完整的脑网络就计算好了！

-[在大脑网络中，FC可以被看作是大脑网络传统节点中心表示的延伸和补充](https://bing.com/search?q=FC值在功能脑网络中的作用)[1](https://bing.com/search?q=FC值在功能脑网络中的作用)[。对于正常的大脑高级认知功能来说，往往并不仅仅是单独的某个脑区在起作用，而是更加依赖于不同脑区之间的相互协同工作](https://blog.csdn.net/weixin_41880581/article/details/103573441)[2](https://blog.csdn.net/weixin_41880581/article/details/103573441)[。因此，研究不同脑区的功能连接对我们理解大脑的大脑高级认知功能机制来说非常重要](https://blog.csdn.net/weixin_41880581/article/details/103573441)[2](https://blog.csdn.net/weixin_41880581/article/details/103573441)

## 不同模态的脑网络的构建

-**不同模态脑网络有五种构建方式：功能脑网络、结构脑网络、白质纤维束网络、加权脑网络、二值网络**

### 功能脑网络

**-功能脑网络：首先，获取了每个脑区的信号序列。其次，计算任意两个信号序列间的相关（皮尔逊相关）。把脑区视为节点，相关值视为边，连接边和节点就构造好了功能网络**

### 结构脑网络

**-结构脑网络的2种构建方式：**

方式1：假定我们有100名被试，计算出**红色脑区和蓝色脑区的平均灰质密度值（GMV）**（[在神经学中，平均灰质密度值（GMV）是对整个大脑灰质组织的量化指标，用于测量大脑的总体灰质密度](https://wenku.csdn.net/answer/7z9by2fya6)[1](https://wenku.csdn.net/answer/7z9by2fya6)[。灰质是中枢神经系统的重要组成部分，由神经元、神经胶质细胞、微血管组成](https://zh.wikipedia.org/wiki/灰质)[2](https://zh.wikipedia.org/wiki/灰质)。得到了**100个红区的GMV和100个蓝区的GMV**。把红区的100个GMV值和蓝区的100个GMV值**做相关**，就得到了**红区和蓝区的相关值**，也就是**红区和蓝区的连边**。当我们把所有脑区间的GMV相关计算出来后，就得到了所谓的**结构共变脑网络**。

方式2：假设每个被试都**每隔三个月扫描一次T1像，至今扫描了12次**。那么对每个被试的红蓝脑区，可分别计算出12个GMV值。对红蓝脑区的12个GMV值**做相关**即得到红蓝脑区间的连接值。



### 白质纤维束脑网络

-**白质纤维束脑网络**：首先，**基于DTI成像，使用纤维追踪技术（以确定性纤维追踪为例）可以追踪出两个脑区间的纤维束。**“**如果两个脑区间存在纤维束，就认为它们之间存在连接，连接强度即为纤维束数量**。也就是说，**在确定性纤维追踪中**，以**脑区为节点**，**纤维束数量值为边构建白质脑网络**。同样地，每个人都可以得到一个纤维束脑网络

-**纤维追踪技术：**[在神经学中，纤维追踪技术是一种基于弥散张量成像（DTI）的方法，用于无创地描绘大脑白质纤维通路](https://zhuanlan.zhihu.com/p/407887063)[1](https://zhuanlan.zhihu.com/p/407887063)[2](https://zhuanlan.zhihu.com/p/618733684)[。这种技术可以帮助我们理解大脑中不同区域之间的物理连接，以及如何影响我们的行为和认知功能](https://zhuanlan.zhihu.com/p/618733684)[2](https://zhuanlan.zhihu.com/p/618733684)。[神经纤维（或轴突）是神经细胞（或神经元）的长线状延伸，连接特定的大脑区域并通过电脉冲传递信息。这些纤维紧密地包裹在一起，形成纤维束或束状物，它们具有共同的起点和终点](https://zhuanlan.zhihu.com/p/618733684)[2](https://zhuanlan.zhihu.com/p/618733684)。[纤维追踪技术通过观察水分子的相关平均扩散模式来间接探测白质纤维的方向。这种方法假设每个成像体素的特征是一个单一的主要纤维方向，并将这些局部方向拼凑在一起来推断全局纤维轨迹](https://zhuanlan.zhihu.com/p/618733684)[2](https://zhuanlan.zhihu.com/p/618733684)。

### 加权网络

-**加权网络**：每个脑网络都可以表示为**邻接矩阵**的形式，横轴和纵轴都是脑区编号，横纵交叉的地方就是相应脑区间的连接值，这种网络就是**加权网络。**”

### 二值网络

-**二值网络**：设定一个**阈值**，当**连接值大于这个阈值时**，**就视为1（有连接）；小于这个阈值时，就视为0（无连接）**，这样就得到一个只区分有连接或者无连接的**二值网络**。其实，我们**很多脑网络指标（出入度、局部效率等）都是在二值网络上计算的**。

## fMRI中的FDR校正

-什么是多重比较，什么是FDR校正呢？**多重比较是统计学中的术语。当我们进行多次统计检验后，假阳性的次数就会增多，所以要对假阳性进行校正。**

-**FDR校正的是在检测出的激活的体素中（Da）**，**伪激活（假阳性）的体素的个数（Via）**。这里要注意和**FWE校正的区别。FWE校正的是在所有被检测的体素中，假阳性体素的个数。**

-例子：假设大脑总共有50000个体素（V=50000），通过假设检验发现有**20000个体素的P<0.05**，也就是说**Da=20000**。**FDR和FWE的校正水平都设为0.05**。那么**FDR说的是在20000个激活的体素中，假阳性的体素不超过20000\*0.05=1000个**。**FWE说的是在总共50000个体素中（包括检测到的激活的体素和不激活的体素），假阳性的体素不超过50000\*0.05=2500个**。**FWE比FDR严格**，是因为**FWE控制的是全脑中假阳性次数**，**FDR控制的是我们发现的激活（Declared active）的体素中假阳性次数。**

### 模板（mask）

-**模板(mask )往往是与ROI联系在一起的**（[在神经脑影像学中，"模板"或"mask"是一种特殊的脑影像，它的每一个位置上不是信号值，而是脑区编号（标签）。这也就意味着我们可以通过感兴趣区域的脑区编号，得到对应的感兴趣区域位置的集合，它也就是感兴趣区域的mask](https://blog.csdn.net/sinat_35907936/article/details/118481241)[1](https://blog.csdn.net/sinat_35907936/article/details/118481241)。）

-在脑影像研究中，**mask把我们不关心的区域屏蔽了**

常见的mask：**二值模板、多值模板、概率模板（在定义什么是灰质，什么是白质的时候我们应该额外的小心。**有时候灰质和白质的边界在MRI上面表现得并不是非灰即白**。（要不然为什么freesurfer估计的表面与cat12估计的表面存在一定出入呢）**在灰质与白质交界的地方存在一些模糊区域**。具体想把大脑灰白质中间这部分模糊区域分割**成灰质还是白质需要自己定义。这就诞生了概率模板。**）。**

![图片](https://ask.qcloudimg.com/http-save/yehe-8223537/9548a387d49df94ef9a1a51900691ade.jpg)

### 计算机存取MRI影像

磁共振机器里面拿出来的数据分成两个部分：**头+脑影像**

![图片](https://ask.qcloudimg.com/http-save/yehe-8223537/03d2a3cb8d272fea47dd6e1f8df28534.jpg)

-火车头里面装载着这个图像的信息，这些信息包含着**层厚，层数，体素大小等等描述后面数据的各个信息**。而每一层的脑影像就存放在后面的多个车厢里面。换句话说，那个火车头就像目录，而**后面的车厢存放的是每一层大脑切片的信息**。如图2所示：在计算机里面，**每一层（大脑切片）的信息就是一张二维的图片，而数字的图片在计算机里面用离散的数值进行储存。每一个数值代表着当前切片颜色的深浅。**

<img src="https://ask.qcloudimg.com/http-save/yehe-8223537/ec99a36a5d6e720f465cab871fee9641.jpg" alt="图片" style="zoom:80%;" />

-**首先**，MATLAB下面**安装好SPM与 rest软件**，基本的rest软件操作想必各位都会。如果你想从中挖出一些更加炫酷狂拽的东西，可以**操作rest软件包里面底层的函数对脑影像进行分析**。

1、读取：运用**rest_ReadNiftiImage**函数。该函数基本用法如下：

 [Data, Head] = rest_ReadNiftiImage(fileName,volumeIndex)或

 [Data, Head] = rest_ReadNiftiImage(fileName)

即 **[火车车身，火车头 ] <= 函数名 （文件存放路径）**

-文件存放路径：你的C盘下存放一个**AAL模板**（名字叫aal.nii），如果你用windows系统那么文件路径就是 C:\aal.nii ，如果你是用linux或者mac系统的话，那么就是 /home/[your name]/aal.nii

**-ALL模板**：[AAL模板，全称是Anatomical Automatic Labeling，是由Montreal Neurological Institute (MNI)机构提供的](https://blog.csdn.net/dxfgcvhjbnklm/article/details/120731430)[1](https://blog.csdn.net/dxfgcvhjbnklm/article/details/120731430)[。AAL模板一共有116个区域，但只有90个属于大脑，剩余26个属于小脑结构](https://blog.csdn.net/dxfgcvhjbnklm/article/details/120731430)[1](https://blog.csdn.net/dxfgcvhjbnklm/article/details/120731430)。

 火车车身：你读取出来的数据（aal模板是3维的数据，你可能看到他的维度是91×109×91的）

 火车头：读取出来数据的头文件。（不用管它是什么啦）

**-其次**，写入（保存）：**rest_WriteNiftiImage(Data,Head,filename)**

data已经换成了新的，而Head还是当时读入的火车头，filename 就是我们需要保存的位置与文件名。这个文件名可以自己取，运用这个函数会自动生成

### 标准空间模板和空间变换

-**标准空间模板**

对功能影像数据做预处理的时候，其中有一步是把**图像normalize到标准空间**。为什么要做这一步呢？**因为每个被试的脑袋大小、形状都不一样**。**如果把它们放到一个坐标系中，同一个脑结构的空间位置就会不一样，这样就不利于研究结果的报道和描述**。因此我们需要**一个共同的参考坐标**。这里讲的标准空间就是这样一个参考坐标。下面用“标准模板”来代替标准空间的意思。

-**Talairach标准模板**：最早的模板

-目前广泛使用的标准模板是**ICBM152模板**

-一般我们认为我们采集到什么样的图像，该图像就在什么空间。比如采集的功能图像，那么它就属于功能像空间；**采集的T1图像，它就属于结构像空间；采集的DTI图像，它就属于DTI空间**。我们做统计分析的时候，一定要保证最后得到的图像一定是在同一个空间，比如都在MNI空间或都在DTI空间。

#### 空间变换

**-自由度：**[在神经影像学中，"自由度"是一个统计学概念，通常用于描述模型的复杂性。在神经网络或机器学习模型中，自由度通常指的是模型中的参数数量，例如线性回归模型中的系数数量或深度学习神经网络中的权重数量](https://zhuanlan.zhihu.com/p/146145121)[1](https://zhuanlan.zhihu.com/p/146145121)。

[值得注意的是，如果机器学习模型中存在过多的自由度（即模型参数），那么这个模型将可能过拟合训练集，这是统计学上的普遍认识。可以通过使用正则化技术来克服这种问题，比如正则化线性回归，以及深度学习神经网络模型中常用的各种正则化手段](https://zhuanlan.zhihu.com/p/146145121)[1](https://zhuanlan.zhihu.com/p/146145121)。

[在图像处理和计算机视觉中，自由度也可以指变换的复杂性。例如，在空间变换中，刚体变换（包括平移和旋转）有6个自由度，仿射变换（包括平移、旋转、缩放和倾斜）有12个自由度](https://www.zhihu.com/question/376632682)[2](https://www.zhihu.com/question/376632682)。这些变换在神经影像学中被广泛应用于图像配准和标准化过程。

[总的来说，"自由度"是一个衡量模型复杂性或变换复杂性的重要指标，在神经影像学和相关领域中有着广泛的应用](https://zhuanlan.zhihu.com/p/146145121)[1](https://zhuanlan.zhihu.com/p/146145121)[2](https://www.zhihu.com/question/376632682)

-**刚体变换（rigid body transformation）**

图像A只需要经过空间的平移和旋转就可以变换到图像B。这样的变换称为刚体变换。在核磁图像中，空间可沿着x、y、z轴平移或旋转。因此刚性变换只需要6个自由度。如下图：

<img src="https://ask.qcloudimg.com/http-save/yehe-8223537/6133bed22a228e263fc0820bbfea4b2a.jpg" alt="图片" style="zoom:50%;" />

​                                                        图像旋转（左）和平移（右）

**-仿射变换（affine transformation）**

**图像A若要配准到图像B，除了需要空间平移和旋转以外，还需要图像的拉伸（Scaling）如放大、缩小，和图像的倾斜（Skews/Shears），这样的变换称为仿射变换**。

<img src="https://ask.qcloudimg.com/http-save/yehe-8223537/17cf5f1aafa6cc4d21887304cbb727bb.jpg" alt="图片" style="zoom: 80%;" />

​                                                      图像的拉伸（左）和倾斜（右）

**-非线性变换**

**图像局部的形变，这样的变换称为非线性变换。非线性变换常用于被试间高分辨率图像间的配准。**在SPM，FSL等软件中，线性变换矩阵一般保存在*.mat文件中

## 小世界网络

-**基本概念**

**网络节点**：网络构成中的一种元素，在核磁成像研究中，节点可以是某个脑区，或者以**体素为单位作为节点。**

**网络边**：网络构成中的另一种元素，**一条边连接网络中的两个节点**。在MRI研究中，边的定义多种多样，比如功能连接、纤维束连接、协变连接等。

**邻居节点**：一个节点i的邻居节点指的是在网络中，和该节点i直接相连接的节点。

**节点度**：指的是一个节点连接边的条数。该节点连接边越多，其度越大。

**聚类系数**：刻画**网络中一个节点的所有邻居节点间的连接紧密程度**。当所有邻居节点间都有连接时，该节点的聚类系数值最大。聚类系数刻画网络局部连接程度。

**最短路径**：在网络中从一个节点出发，要到达另外一个节点所需的最小步长。最短路径刻画网络信息传递的快慢。路径值越小，信息传递越快。

**连接代价**（wiring cost）：从物理空间距离（笛卡尔坐标系中两点间的距离）角度来看，代价可理解为信息从一个节点传递到另外一个节点所消耗的资源。物理距离越远，我们认为信息传输消耗的资源越多，代价越大。

打个比方，如果把每个**人**当做一个**网络节点**，把人与人之间的**好友关系**当做**网络的边，那么邻居节点**就是某人的**直接好友**；**节点度**代表**直接好友的数量**，即朋友数量越多，节点度越高；**聚类系数**理解为某人的**好友之间的友好程度**，比如我的好朋友盖茨、阿云和化腾等等之间都是好朋友，就说明我的聚类系数很高；**最短路径**就是我能联系到某人需要的**最少中转人数**，比如大家可能需要最少中转七八个朋友才能联系到盖茨，而我上礼拜刚和他打完高尔夫，嗯，他的球技最近有所长进，一起愉快的聊了个几个亿的小目标；**连接代价**可以理解为两人见面需要走的路程，是走路就到呢，还是开车呢，还是打飞的呢，距离越远，代价越高。

### **小世界网络**

![图片](https://ask.qcloudimg.com/http-save/yehe-8223537/fa6dc77e65f0baaeb9470b2d1d848c6d.jpg)

最左边的是**正则网络**：它的特点是每一个节点只和它临近的节点有连接。因此我们可以推测它的聚类系数值很高，局部连接很紧密。但是它的弱点是最短路径值很大，也就说路径长度很长，信息传递很慢。

最右边的是**随机网络**：它的特点是几乎每个节点都有远距离连接的边。因此可以推测它的最短路径长度值很小（从一个节点到另外一个节点只需要2-3步即可到达），所以随机网络的信息传递很快，效能高。但是它的弱点是它的聚类系数值很小，即是局部连接不紧密，网络的稳定性差。

**给定网络A，如果A的聚类系数/随机网络的聚类系数 >>（远大于）1，并且A的最短路径/随机网络的最短路径≈1**，就说A是**小世界网络。**

### **脑网络的小世界属性**

**-经济性脑网络**

![图片](https://ask.qcloudimg.com/http-save/yehe-8223537/3719226349143007d36078475cb32914.jpg)

从左到右依次是正则网络、小世界网络、随机网络。从代价-效能角度来看，正则网络的代价很低（因为它只有短连接的边，所以消耗的资源少），同时效能也很低（因为路径长度很高）。随机网络的代价很高（因为它长连接的边很多，所以消耗的资源多），同时效能也很高（因为路径长度很小）。**小世界网络就结合了这两者的优势，即代价比较低**（只有少量的长连接边），**但是效能很高**（正是因为有少量的长连接边，所以路径长度较小）。所以说，人类大脑是较低消耗，但是效能很高的小世界网络。

-**节点度的幂律分布**

![图片](https://ask.qcloudimg.com/http-save/yehe-8223537/c84a6efdfc38187db2bf15b19e38da92.jpg)

大脑网络的另外一个特性-节点度的幂律分布。如上图，横坐标是对节点度取对数后的值，纵坐标是对累计分布取对数后的值。幂律分布的特点是**大部分节点的度都比较小，只有少部分节点的度很大**。度很大的节点也称为枢纽节点（Hub）。Hub节点可以认为是大脑信息传递的中心，它消耗大脑资源就比较多。

**-模块化结构**

![图片](https://ask.qcloudimg.com/http-save/yehe-8223537/5e419f8efde017efebf969027cf85d0a.jpg)

具有模块化的分布结构。从数学上讲，一个模块包含了一些脑区，这些**模块内的脑区相互之间连接很紧密，然而它们和该模块外的脑区连接相对很少**。如果把大脑比作一个公司，每个模块就是一个部门，各部门内部员工之间交流紧密，而部门间主要通过负责人进行交流。返回到脑功能层面，一个模块是由那些功能相似的脑区组成，这样整个模块参与相关任务的处理，处理速度就会很快。上面的图就是大脑模块化结构的一个例子。大脑的模块主要有：默认网络、视觉网络、听觉网络、执行控制网路等。

## ICA的基本原理及在fMRI中运用

-**ICA:**假设某个数据 是由 *n* 个独立的数据源而产生的。我们观察到的是：

***x = As\***

这里矩阵 *A* 是方阵，被称作混合矩阵。观察或者记录 *m* 次，就可以得到一个数据集**{ *x(i); i = 1, 2, … , m*}**，我们的目标是利用已经产生的数据**( *x(i) = As(i)* )**去恢复出数据源 *s(i)*。只有观测信号x是我们已知的，而混合矩阵A和源信号矩阵s对于我们都是未知的。学过九年制义务教育这种顶级学历水平的我们知道，只有一个等式是没法求出两个未知数的，此时A和s可以有无穷多个解。所以我们需要加入更多的限制条件来对其进行约束。这里引入一个中心极限定理（Central Limit Theorem）的概念，在适当的条件下，大量相互独立随机变量的均值经适当标准化后依分布收敛于正态（高斯）分布。简单来说，越是混合的变量，越是高斯（高斯性越强）。那我们在一起反向思考就可以发现，越是独立的变量，非高斯性就会越强。如果我们再假设我们的源信号都是相互独立的，再用峰度（kurtosis）等参数对变量的非高斯性进行量化，那么只要找到非高斯性最强的一组相互正交的变量集s，就是我们要求得的原始信号了**！**

**ICA在fMRI中的应用**:**由于**fMRI数据是一个四维数据**（三维空间加一维的时间）；**由于四维空间比较难以想象，为了便于想象，我们先以下图的方式将一个三维的矩阵重新排列成一个一维的向量。

![图片](https://ask.qcloudimg.com/http-save/yehe-8223537/0d104dd6a3f980e123cf52e5948183d1.jpg)

-假设我们包含**v个体素fMRI数据，时间点为t个**，该数据**包含k个相互独立源信号，我们的四维fMRI数据就可以表示成一个时间（time）\*空间（space）的t\*v的二维矩阵，在ICA中，这也是我们的观测信号矩阵x**（下图等式最左）；而我们要求解的源信号s矩阵则为源信号成分（source）*空间（space）的k*v的矩阵（下图等式最右），即每个成分的空间分布图；而每个成分的时间序列，即时间（time）*源信号成分（source）的t*k的矩阵（下图等式最右），则为混合矩阵A。

![图片](https://ask.qcloudimg.com/http-save/yehe-8223537/c44fbd04736482a8004b1abe8d9d52e3.jpg)