# MRtrix3教程

### 基础概念

- 1. T1像与T2像

在T1或解剖扫描中，白质比灰质浅，而灰质又比脑脊液浅；在T2或功能扫描中，相对强度被翻转。

![T1_T2](https://liaopan.github.io/mrtrix/images/00_T1_T2_Intensities.png)

图：典型的T1加权（解剖）和 T2加权（功能）图像。注意从T1加权成像到T2加权成像时组织类型的相对强度是如何反转的。

- **扩散加权核磁共振成像，或称dMRI（*扩散加权核磁共振成像（Diffusion Weighted Imaging，DWI）或扩散磁共振成像 (dMRI) 是一种侧重反映组织间水分子扩散情况的对比，是目前颅脑MRI最常用的序列之一。它主要依赖于水分子的运动而非组织的自旋质子密度、T1值或T2值，为组织成像对比提供了一种新的技术*。），它测量大脑不同部位的相对扩散性–特别是在白质束内。**
- [在dMRI中，DWI是在MRI序列是基础上，在x、y、z轴三个互相垂直的方向上施加扩散敏感梯度，从而获得反应体内水分子扩散运动状况的MR图像](https://zhuanlan.zhihu.com/p/556417296)[4](https://zhuanlan.zhihu.com/p/556417296)[。计算公式为：A=exp（-bD），其中，A—扩散引起的磁共振信号衰减；D—扩散系数（diffusion coefficient），反应扩散运动的快慢，单位：mm2/s；b—扩散因子，单位：s/mm2，低b值（小于1000s/mm^2）对快速扩散运动敏感，b值与施加的扩散敏感梯度场强、持续时间和间隔、幅度、形状有关](https://zhuanlan.zhihu.com/p/112886149)[2](https://zhuanlan.zhihu.com/p/112886149)
- [通过两个以上不同弥散敏感梯度值（b值）的弥散加权像，可以计算出弥散敏感梯度方向上水分子的表观扩散系数（apparent diffusion coefficient，ADC）。实际上DWI所观察到的扩散效应除了反应水分子自身扩散运动之外，还与使用的b值、呼吸、脉搏等运动的影响有关](https://zhuanlan.zhihu.com/p/112886149)[2](https://zhuanlan.zhihu.com/p/112886149)。

- ##### 2. 白质的结构

- 为什么dMRI会关注白质束？想象一下剥开一根奶酪条，然后想象一下剥开大脑–就像奶酪条一样，大脑有首选的撕裂方向。这些方向与底层白质束相对应，白质束是厚厚的有髓神经元束（myelinated neurons），连接着大脑的附近和遥远的部分。例如，下纵束(inferior longitudinal fasciculus)连接大脑的视觉和颞部区域，而钩束(uncinate fasciculus)则连接大脑的颞部和下额部。这些神经束沿着大脑的所有三个维度行进，它们可能相互平行或相互交叉。

![white matter](https://liaopan.github.io/mrtrix/images/00_Tract_Examples.webp)

 *几个主要白质束的插图*。

- 大脑的白质因其颜色而得名；这些神经元是高度髓鞘化的，这意味着它们有一层厚厚的脂质涂层，既能使它们绝缘，又有助于电脉冲的传输，就像绝缘的电线。相比之下，灰质神经元则相对没有髓鞘，这使得特定区域内的神经元密度更高。

## 3.扩散梯度（Diffusion Gradient）与B值（B-value）

- 扩散梯度由以下参数生成：
  - The magnitude of diffusion gradient (G);
  - The time between gradients (𝚫) ;
  - T duration of diffusion gradient (𝜹). 这些可以组合成一个方程式，即所谓的b值，如下图所示。

![Bvalue](https://liaopan.github.io/mrtrix/images/00_BValue.png)

请注意，b值与梯度的大小、梯度的持续时间和梯度之间的时间成正比；如果这些参数中的任何一个增加，b值也会随之增加。

下图所示b值为0的扩散加权图像与典型的T2加权图像几乎相同–脑脊液（CSF）是亮的，灰质是暗的。当我们增加b值时，我们看到在大脑的特定部位，主要是白质内有更大的信号损失。这是因为这些白质束内的**水主要沿着束的方向扩散**，生成的图像显示出相应的低信号。(较高的b值也使图像更容易受到图像伪影的影响，如运动和被称为涡流（eddy）的磁流）。

![bvalues](https://liaopan.github.io/mrtrix/images/00_bvalues.webp)

## B 向量

到目前为止，我们已经了解了如何应用扩散梯度，以及如何解释图像中产生的信号。为了完善我们对扩散图像如何创建的理解，我们还需要知道所应用的梯**度的方向。**这些方向被称为**b向量**，简称**bvecs**。您会注意到，从扩散加权扫描下载数据后，您将有两个文本文件 - 一个通常具有后缀 .**bval**，以指示 b 值，另一个带有后缀 **.bvec**，代表 b 向量。

假设您收集了 40 个扩散加权图像。我们还假设第一个卷的 b 值为零，其余卷的 b 值为 1000。bvals 文件将有 40 个条目，每个 bval 对应于扩散加权图像中的一个单个体积。另一方面，bvecs 文件将有 40 个*三元组*数字，指示该体积在 x、y 和 z 方向上的扩散梯度方向。如果我们知道梯度的方向和大小，我们就可以根据从这些体素获得的信号的变化，对沿梯度的扩散做出有根据的猜测。

![../../_images/00_bvals_bvecs.png](https://andysbrainbook.readthedocs.io/en/latest/_images/00_bvals_bvecs.png)

*.bvals 和 .bvecs 文件的示例内容。如果将bvecs文件导入电子表格，则其结构会更清晰;该文件的格式设置为将数字分组为三元组。每个三元组的bvecs对应于一个bval。*

## 对张量进行建模

- **bvals和bvecs的这种组合**使我们能够构造一个**称为张量**的东西，并将其拟合到扩散加权图像的每个体素。在本教程中，请将张量视为沿 x、y 和 z 维度推动的力模型。例如，流经花园软管的水会推动管子的边界，但主要沿着软管的长度流动。我们称能量特征**向量**的方向和能量**特征值**的大小。

- 应用于扩散加权图像，我们使用这些相同的概念将在每个体素观察到的信号建模为特征向量和特征值的组合。特征向量表示扩散的方向，特征值表示扩散的大小。以花园软管为例，水的力将沿管子长度具有较高的特征向量和特征值;同样，我们可以将大脑每个体素中的扩散建模为特征向量和特征值的组合。一旦我们计算出最能代表在当前体素中观察到的信号的值的组合，我们就可以使用许多不同的方程来计算该体素扩散的不同属性。这种**扩散张量成像**最流行的方程称为**分数各向异性**，简称FA。这可以使用以下公式计算：![../../_images/00_FA_formula.png](https://andysbrainbook.readthedocs.io/en/latest/_images/00_FA_formula.png)

- 分数各向异性是每个体素中特征值的加权和。较高的 FA 值表示沿其中一个方向的扩散较大，而较低的 FA 值表示扩散很小，或者扩散不受约束并且随机向每个方向移动（例如，在大脑的脑室中）。如果我们发现扩散沿其中一个维度更大，我们可以根据方向对其进行颜色编码。扩散成像中的惯例是用红色表示沿 x 轴的扩散，用绿色表示沿 y 轴的扩散，用蓝色表示沿 z 轴的扩散。下图总结了这种颜色编码方案。

![../../_images/00_Eigenvectors.png](https://andysbrainbook.readthedocs.io/en/latest/_images/00_Eigenvectors.png)

### 其他扩散

- 平均扩散系数 （MD）：特征值的平均值，通过将特征值相加并除以 3 来计算。有助于识别脑部病变，如水肿。
- 轴向扩散系数 （AD）：最大特征值的值。
- 径向扩散系数 （RD）：两个最小特征值的平均值。通常用于分析朝向同一方向的大纤维束，例如胼胝体。

## 扩散张量成像的缺点：交叉纤维问题

- 尽管扩散张量成像自扩散加权成像开始以来一直是最流行的分析方法之一，但它一直受到**交叉纤维问题的**阻碍。上述张量拟合方法对于分析仅包含沿单个方向行进的白质束的体素非常有用。另一方面，如果体素包含相互交叉的纤维，则该方法可能会导致虚假结果。举一个最极端的情况，假设我们已经获得了单个体素的扩散加权图像，并且该体素包含彼此成直角交叉的白质纤维。由于张量被约束为生成单个解以估计其所有特征向量和特征值，因此无法单独估计每束纤维的扩散方向和大小。相反，它将拆分差异并得出结论，沿任何方向都没有扩散 - 换句话说，两个道的扩散将相互抵消。

![../../_images/00_CrossingFibers.png](https://andysbrainbook.readthedocs.io/en/latest/_images/00_CrossingFibers.png)

*白质纤维以直角相互交叉的图示*

为了解决这个问题，开发了一种称为**球形反卷积**的技术。球面反卷积不是试图为每个体素测量的复杂信号找到单一的解决方案，而是假设扩散信号是多个以不同角度相互交叉的单个纤维所期望的信号的平均值。因此，使用单根纤维作为**基函数**来对更复杂的信号进行去卷积

![../../_images/00_BasisFunction.png](https://andysbrainbook.readthedocs.io/en/latest/_images/00_BasisFunction.png)

-与扩散加权数据类似，我们从许多**不同的角度**获取每个体素中的扩散信号，以形成扩散方向及其幅度的图片。然后将信号去卷积成一组朝向不同方向的单个纤维。不是每个体素上的单个扩散数，而是使用球形反卷积来生成**纤维取向密度函数**或FOD。该函数表示为具有卵形轴的形状;尽管加载到主要扩散方向上的轴的波瓣相对于其他轴变得更长更大，但沿其他轴的扩散方向和强度的信息仍然保留。

![../../_images/00_ODF.png](https://andysbrainbook.readthedocs.io/en/latest/_images/00_ODF.png)

*图为扩散加权图像，其上叠加了FOD。*